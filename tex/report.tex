\documentclass{llncs}
\usepackage[utf8]{inputenc}
\usepackage{fancyvrb} 
\usepackage[portuguese]{babel}
\usepackage{ragged2e}

\begin{document} \mainmatter
\title{Conversor de ficheiros GPX para KML}
\titlerunning{Conversor de ficheiros GPX para KML}
\author{José Carlos Lima Martins A78821 \and
        Miguel Miranda Quaresma A77049}
\authorrunning{José Carlos Lima Martins A78821 \and
        Miguel Miranda Quaresma A77049}
\institute{                                                                
University of Minho, Department of  Informatics, Braga, Portugal\\
e-mail: \{a78821,a77049\}@alunos.uminho.pt
}

\maketitle

\justify

\begin{abstract}
De modo a converter um ficheiro GPX (GPS Exchange Format) para KML (Keyhole Markup Language) foi usado o FLEX (fast lexical analyzer generator). Esta conversão permite que a partir de ficheiros gerados pelos gps's por exemplo seja possível ver o conteúdo guardado pelo mesmo no Google Earth (Maps.me, etc).
\end{abstract}

\section{Estrutura do Relatório}
Após realizar a introdução, iremos explicar as estruturas/tags dos diferentes ficheiros/linguagens (GPX,KML) no Preâmbulo. De seguida é explicado de forma sucinta o problema presente, para de seguida apresentar a solução por nós proposta. Será depois apresentado como executar e possiveis testes a realizar. Por fim, será concluído os resultados bem como avaliado o trabalho desenvolvido.

\section{Introdução}
Para realizar a conversão de tipos foi usado o FLEX, uma ferramenta poderosa que permite criar analisadores léxicos de modo a reconhecer padrões no input e consoante o padrão agir de acordo com ele produzindo ou não output, dependendo do que é pretendido. É importante também destacar que caso não fosse usado o FLEX seria muito complicado implementar algo que desse os mesmos resultados, demorando muito mais tempo a implementar, até porque a deteção de padrões não é algo simples.

\section{Preâmbulo}\label{pb}
De modo a compreender-se melhor o que foi desenvolvido é importante conhecer as estruturas (tags) dos dois tipos. Os dois são baseados no XML (Extensible Markup Language) e como tal tem algumas parecências mudando principalmente as tags e os seus significados. 

Em relação à estrutura do GPX é importante referir que:
\begin{itemize}
    \item \verb|<gpx creator="..." version=".." ..>| raiz do documento XML, indica as versões(\textit{standards}) dos diversos campos presentes no documento
    \item \verb|<metadata>| contém informação sobre o documento GPX: autor do documento, altura de criação, restrições de direito de autor, altura de criação entre outros, etc
    \item \verb|<wpt lat="..." lon="...">| representa um \textit{waypoint} definido  localizado nas coordenadas dadas
        \subitem \verb|<name>| indica o nome do waypoint referido
        \subitem \verb|<time>| indica o timestamp referente à passagem no waypoint
        \subitem \verb|<ele>| indica a altitude do waypoint
        \subitem \verb|<desc>| breve descrição do waypoint
    \item \verb|<trk>| representa um \textit{track} \textbf{i.e.} um conjunto de pontos que compõem um percurso
        \subitem \verb|<name>| indica o nome do percurso
        \subitem \verb|<desc>| descrição do percuro
        \subitem \verb|<type>| indica o tipo de percurso a que se refere(caminhada, ciclismo, etc)
        \subitem \verb|<extensions>| contém informações adicionais como distancia, desnível positivo/negativo, calorias queimadas
    \item \verb|<trkseg>| representa um segmento contínuo de pontos
        \subitem \verb|<trkpt lat="..." lon="...">| ponto constituinte do segmento com as coordenadas indicadas
\end{itemize}

Já em relação à estrutura do KML é de destacar o seguinte:
\begin{itemize}
    \item \verb|<?xml version="1.0" encoding="utf-8"?>|: indica a versão do XML e a encodificação 
    \item \verb|<kml xmlns="http://www.opengis.net/kml/2.2">|: indica a versão do KML usado, pode ser também adicionado extensões dentro da tag
    \item \verb|<Placemark>|: representa como o próprio nome indica um marcador de um local/trilho/ponto/etc
    \item \verb|<name>|: presente tanto no \verb|<Document>| como no \verb|<Placemark>| permite dar um nome ao documento ou ao local respetivamente
    \item \verb|<description>|: permite descrever/caracterizar o \verb|<Document>| ou o \verb|<Placemark>|
    \item \verb|<LineString>|: permite representar um caminho/trilho, deve estar dentro da tag \verb|<Placemark>|
    \item \verb|<Point>|: permite representar um ponto/marco no mapa, deve estar dentro da tag \verb|<Placemark>|
    \item \verb|<coordinates>|: é aqui adicionado as coordenadas e alturas de cada ponto do caminho a ser ``desenhado'' no caso de estar dentro de uma tag \verb|<LineString>|, caso esteja dentro de um \verb|<Point>| permite indicar a localização e altura do ponto, sendo que a organização é longitude,latitude,altura por cada linha
    \item \verb|<altitudeMode>|: permite defenir que tipo de modo de altitude é usada, decidimos no nosso caso usar absolute (ou seja, a altitude é referente ao nível do mar), deve também estar dentro da tag \verb|<LineString>| ou da tag \verb|<Point>|
\end{itemize}

\section{Análise e especificação}

\subsection{Descrição informal do problema}
O problema consiste na conversão de um ficheiro GPX, gerado principalmente por navegadores GPS, para um ficheiro KML, criado e mantido pela gigante Google. Isto envolve conhecer as tags e estruturas de cada ``linguagem'' algo que já foi abordado no preâmbulo. A maior dificuldade reside no facto de que existe tags presentes numa linguagem que não existe na outra e vice-versa, e isso cria um problema de decisão, ou seja, é necessário escolher a tag que melhor representa a informação presente no ficheiro do qual partimos.

\subsection{Especificação do Requisitos}

\section{Concepção/desenho da Resolução}

\subsection{Estruturas usadas}

\subsection{Algoritmos(Lógica)}
De certa maneira o que é realizado é sempre que algo aparece (condição) realizamos uma ação, neste caso escrever para um ficheiro algo que corresponda com o match da condição. Contudo devido às diferentes tags entre os dois tipos, nem sempre é assim tão simples obrigando a algumas estratégias.

Uma das estratégias é o uso de condições de contexto de modo a isolar secções nas situações em que por exemplo existe a mesma tag contudo dentro de tags diferentes, representando coisas diferentes. Ajuda-nos também a estruturar melhor o código, bem como simplifica-o por vezes.

Outra estratégia foi o uso de uma stack de modo a sabermos em que condição de contexto estavamos antes de entrar numa nova condição de contexto de modo a sabermos para onde voltar ao sair dessa condição, derivado do facto de se puder entrar nesta nova condição por condições de contexto diferentes. Um exemplo disto é a condição de contexto LINK e a sua stack \textit{stackLink}.

Por fim outra estratégia usada, foi o uso de um ``boolean'' na condição de contexto METADATA visto que, como a tag name do GPX presente no mesmo deve ficar fora da tag description do KML e que os restantes casos do mesmo(METADATA) devem ficar dentro da tag description este boolean foi usado de modo a sabermos se já tinha sido ou não imprimido no ficheiro \verb|<description>| e em caso negativo fazê-lo. Caso já se tenha imprimido \verb|<description>| e apareça a tag name ela é ignorada e não é imprimida de modo a não criar incongruências.

\section{Codificação e Testes}
Com o objetivo de testar o programa criado em FLEX, foram transferidos ficheiros presentes em https://www.openstreetmap.org/traces (2673775.gpx, 2673778.gpx, 2673781.gpx, 2684029.gpx, 2684078.gpx) bem como alguns pessoais (Small.gpx, Route.gpx).

De modo a testar deve-se usar o programa preferencialmente da seguinte maneira:
\begin{itemize}
    \item Compilar o ficheiro gpxToKml.l com o FLEX: \verb|flex gpxToKml.l|
    \item Compilar o ficheiro lex.yy.c: \verb|gcc -o gpxToKml lex.yy.c|
    \item Executar: \verb|./gpxToKml < ficheiroInput.gpx > ficheiroOutput.kml|
    \item Importar para o Google Earth, etc
\end{itemize}

Ou, devido à existência de uma Makefile realizar simplesmente:
\begin{itemize}
    \item \verb|make install|
    \item \verb|./gpxToKml < ficheiroInput.gpx > ficheiroOutput.kml|
    \item Importar para o Google Earth, etc
\end{itemize}

Sendo também possivel com a Makefile limpar os ficheiros criados usando \verb|make clean|.

\section{Conclusão}
Em conclusão, o resultado obtido foi bom, visto que é possível visualizar o trajeto presente no GPX no Google Earth, etc através da importação do ficheiro KML gerado pelo conversor. Contudo, de modo a melhorar o conversor, poderiamos realizar a conversão das restantes tags do GPX para KML. É importante concluir também que devido ao uso do FLEX com os seus poderosos mecanismos tais como as condições de contexto, permitiu que a resolução do problema fosse mais rápido de obter, mais simples e com bem menos linhas de código, mantendo-se contudo de fácil interpretação.

\section(Lista de Siglas e Acrónimos)
\begin{itemize}
    \item GPX   GPS Exchange Format
    \item KML   Keyhole Markup Language
    \item Flex  fast lexical analyzer generator
    \item GPS   Global Positioning System
    \item XML   Extensible Markup Language
\end{itemize}

\appendix
\section{Código do Programa}

\end{document}
